<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
    <title>My Information</title>
    <link rel="stylesheet" href="style.css">
    <style>
    .profile-details {
        background-color: #f8f9fa;
        padding: 1.5rem 2rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    .profile-details p {
        margin: 0.75rem 0;
        font-size: 1.1rem; /* Slightly larger font */
        color: #333; /* Ensure paragraph text is dark */
    }
    .profile-details strong {
        color: #111; /* Darker color for the labels */
        width: 80px; /* This will align "Name:" and "Email:" nicely */
        display: inline-block;
        font-weight: 600;
    }
    /* This rule specifically targets the user's data */
    .profile-details span {
        color: #555; /* A soft, very readable dark grey */
        font-weight: 500;
    }
    .cases-header {
        margin-top: 2rem;
        font-size: 1.5rem;
        color: #1d2b4a;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #ddd;
    }
    
    /* Using case card styles from search.html */
    .case-list-container { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 1.5rem; }
    .case-card { background-color: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; overflow: hidden; }
    .case-card img { width: 150px; height: 100%; object-fit: cover; }
    .case-info { padding: 1rem 1.5rem; flex-grow: 1; }
    .case-info h3 { margin-bottom: 0.5rem; color: #1d2b4a; }
    .case-info p { margin: 0.25rem 0; color: #555; font-size: 0.9rem; }
    .case-info strong { color: #333; width: auto; display: inline; } /* Resetting strong for inside cards */
    .status-badge { float: right; background-color: #28a745; color: white; padding: 0.25rem 0.6rem; border-radius: 12px; font-size: 0.8rem; }
</style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container"><a href="/dashboard.html" class="nav-logo">FindMyOne</a>
            <ul class="nav-menu">
    <li class="nav-item"><a href="/dashboard.html" class="nav-link">Report a Case</a></li>
    <li class="nav-item"><a href="/search.html" class="nav-link">Search Cases</a></li>
    <li class="nav-item"><a href="/profile.html" class="nav-link active">My Information</a></li>
    <li class="nav-item"><a href="/help.html" class="nav-link">Help</a></li>
    <li class="nav-item"><a href="/login.html" class="nav-link logout">Logout</a></li>
</ul>
        </div>
    </nav>

    <div class="main-content">
        <div class="content-container">
            <h1>My Information</h1>
            <div class="profile-details">
                <p><strong>Name:</strong> <span id="user-name">Loading...</span></p>
                <p><strong>Email:</strong> <span id="user-email">Loading...</span></p>
            </div>

            <h2 class="cases-header">My Reported Cases</h2>
            <div id="my-cases-list" class="case-list-container">
                <p>Loading your reported cases...</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const userNameEl = document.getElementById('user-name');
            const userEmailEl = document.getElementById('user-email');
            const myCasesListEl = document.getElementById('my-cases-list');

            // --- Fetch User Details ---
            try {
                const userResponse = await fetch('/api/user/me');
                if (!userResponse.ok) throw new Error('Could not fetch user details.');
                const userData = await userResponse.json();
                userNameEl.textContent = userData.name;
                userEmailEl.textContent = userData.email;
            } catch (error) {
                userNameEl.textContent = 'Could not load.';
                userEmailEl.textContent = 'Please log in again.';
            }

            // --- Fetch User's Reported Cases ---
            try {
                const casesResponse = await fetch('/api/cases/mycases');
                if (!casesResponse.ok) throw new Error('Could not fetch cases.');
                const myCases = await casesResponse.json();

                myCasesListEl.innerHTML = ''; // Clear "Loading..." message
                if (myCases.length === 0) {
                    myCasesListEl.innerHTML = '<p>You have not reported any cases yet.</p>';
                } else {
                    myCases.forEach(caseItem => {
                        const caseCard = `
    <div class="case-card">
        <div class="case-card-image">
            <img src="${caseItem.photoPath || caseItem.imageURL}" alt="Photo of ${caseItem.fullName}">
        </div>
        <div class="case-info">
            <span class="status-badge">${caseItem.status}</span>
            <h3>${caseItem.fullName}</h3>
            <p><strong>Age:</strong> ${caseItem.age}</p>
            <p><strong>Last Seen:</strong> ${caseItem.lastSeenLocation}</p>
            <a href="/case-details.html?id=${caseItem._id}" class="btn-details">More Details</a>
        </div>
    </div>
`;
                        myCasesListEl.innerHTML += caseCard;
                    });
                }
            } catch (error) {
                myCasesListEl.innerHTML = '<p>Could not load your cases. Please try again later.</p>';
            }
        });
    </script>
</body>
</html>